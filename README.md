# WeatherSubscriptionApp

WeatherApp — це застосунок на Go, який дозволяє користувачам підписуватися на погодні умови для конкретних міст і отримувати сповіщення, коли ці умови виконуються. Він інтегрується з API OpenWeatherMap для отримання даних про погоду та використовує PostgreSQL для зберігання даних. Створено для SKLEAR.

---

## Архітектура

Додаток побудований на Go, використувує Postgre, і сповіщає юзерів про погоду використовуючи [Resend](https://resend.com). Я зробив кастомні conditions, які (як на мене) не тяжко відтворити з гіпотетичного front-end. В БД зберігаються юзери, підписки (Subscriptions) і історія відправлених повідомлень (Notifications). Приклад condtition: "main:clear" (безхмарно),"temperature:<=:35", "humidity:>:23", "feels_like:==:12.3". Додаток складається з 3 шарів: DB+repository layer, Service layer, Handler/Controller layer; паттерн MVC. Це випробувані часом паттерни, тому я їх обрав.

---

## Features

- **Управління користувачами**: Створення облікових записів користувачів.
- **Управління підписками**: Підписка на погодні умови для конкретних міст.
- **Сповіщення про погоду**: Автоматичне сповіщення користувачів, коли їхні підписані погодні умови виконуються.
- **Отримання даних про погоду**: Отримання актуальних даних про погоду для будь-якого міста.
- **Міграції бази даних**: Управління схемою бази даних за допомогою міграцій.
- **Перевірка стану**: Простий ендпоінт для моніторингу стану сервера.

---

## Необхідне

- [Go 1.24+](https://golang.org/dl/)
- [Docker](https://www.docker.com/) (опціонально, для запуску PostgreSQL)
- [PostgreSQL](https://www.postgresql.org/)
- Ключ API OpenWeatherMap
- Ключ API Resend (для email-сповіщень)

---
## Як встановити

1. Клонуйте репозиторій:
    ```bash
    git clone https://github.com/your-repo/weatherapp.git
    cd weatherapp
    ```

2. Скопіюйте файл `.env-example` до `.env` і заповніть необхідні значення:
    ```bash
    cp .env-example .env
    ```

3. Зберіть застосунок:
    ```bash
    go build -o weatherapp .
    ```

4. Запустіть базу даних за допомогою Docker (опціонально):
    ```bash
    docker-compose up -d
    ```

5. Запустіть застосунок:
    ```bash
    ./weatherapp
    ```

---

## Ендпоінти

### Управління користувачами
- **POST** `/user`: Створення нового користувача.

### Управління підписками
- **POST** `/subscribe`: Створення нової підписки.
- **GET** `/weather`: Отримання даних про погоду для міста.

### Перевірка стану
- **GET** `/health`: Перевірка, чи працює сервер.

---

## Конфігурація

Застосунок використовує змінні середовища для конфігурації. Нижче наведено необхідні змінні:

- `OPENWEATHERMAP_API_KEY`: Ваш API-ключ OpenWeatherMap.
- `POSTGRES_CONNECTION_STRING`: Рядок підключення до PostgreSQL.
- `RESEND_API_KEY`: API-ключ Resend для email-сповіщень.
- `PORT`: Порт, на якому працюватиме сервер.

---

## Міграції бази даних

Щоб застосувати міграції бази даних, використовуйте наступні команди:

- Міграція вгору:
  ```bash
  go run main.go
  ```

- Міграція вниз:
  Змініть функцію `MigrateDownAll` у файлі `internal/database/migrations.go` і запустіть застосунок.

---

## Тестування

Запустіть тести за допомогою:
```bash
go test ./...
```

---

## Структура проєкту

- **`internal/handlers`**: HTTP-обробники для API-ендпоінтів.
- **`internal/services`**: Бізнес-логіка та сервісний шар.
- **`internal/database`**: Операції з базою даних та міграції.
- **`internal/models`**: Дані моделі.
- **`internal/server`**: Налаштування сервера та маршрутизація.
- **`internal/tests`**: Юніт-тести та моки.

---

## Автор

Maksym Nosal  
- GitHub: [MaxUnlimited101](https://github.com/MaxUnlimited101)  
